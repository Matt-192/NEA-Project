DROP DATABASE Brackets;
CREATE DATABASE Brackets;
USE Brackets;
CREATE TABLE User_mst (UserID INT PRIMARY KEY NOT NULL AUTO_INCREMENT, Username VARCHAR(32) NOT NULL, PasswordHash VARCHAR(128) NOT NULL, PasswordSalt CHAR(4) NOT NULL, AccountType CHAR(1), EmailAddress VARCHAR(254) NOT NULL);
CREATE TABLE Team_mst (TeamID INT PRIMARY KEY NOT NULL AUTO_INCREMENT, TeamName VARCHAR(32) NOT NULL, CoachID INT NOT NULL, FOREIGN KEY (CoachID) REFERENCES User_mst(UserID));
CREATE TABLE UserToTeam_xrf (UserID INT NOT NULL, TeamID INT NOT NULL, FOREIGN KEY (UserID) REFERENCES User_mst(UserID), FOREIGN KEY (TeamID) REFERENCES Team_mst(TeamID), PRIMARY KEY (UserID, TeamID));
CREATE TABLE Rules_mst (RulesetID INT PRIMARY KEY NOT NULL AUTO_INCREMENT, MatchLength TINYINT NOT NULL, ExtraTime TINYINT NOT NULL, ExtraTimeLength TINYINT NOT NULL, Penalties TINYINT NOT NULL, NumPlayers TINYINT NOT NULL);
CREATE TABLE League_mst (LeagueID INT PRIMARY KEY NOT NULL AUTO_INCREMENT, LeagueName VARCHAR(64) NOT NULL, RulesetID INT NOT NULL, TeamLimit INT, RegisteredTeams INT NOT NULL, LeagueStarted TINYINT NOT NULL, Format TINYINT NOT NULL, FOREIGN KEY (RulesetID) REFERENCES Rules_mst(RulesetID));
CREATE TABLE TeamToLeague_xrf (TeamID INT NOT NULL, LeagueID INT NOT NULL, Ranking TINYINT, GoalDifference INT, Wins INT, Losses INT, FOREIGN KEY (TeamID) REFERENCES Team_mst(TeamID), FOREIGN KEY (LeagueID) REFERENCES League_mst(LeagueID), PRIMARY KEY (TeamID, LeagueID));
CREATE TABLE Matches_dtl (MatchID INT PRIMARY KEY NOT NULL AUTO_INCREMENT, LeagueID INT NOT NULL, Team1ID INT NOT NULL, Team2ID INT NOT NULL, RefereeID INT, Team1Score TINYINT, Team2Score TINYINT, Team1Penalties TINYINT, Team2Penalties TINYINT, WinnerTeamID INT, FOREIGN KEY (LeagueID) REFERENCES League_mst(LeagueID), FOREIGN KEY (Team1ID) REFERENCES Team_mst(TeamID), FOREIGN KEY (Team2ID) REFERENCES Team_mst(TeamID), FOREIGN KEY (RefereeID) REFERENCES User_mst(UserID), FOREIGN KEY (WinnerTeamID) REFERENCES User_mst(UserID));
